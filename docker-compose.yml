version: '3.8'

services:
  firebase-emulators:
    build:
      context: .
      dockerfile: docker/emulators.Dockerfile
      args:
        BUILDKIT_INLINE_CACHE: "0"
      no_cache: true
    image: kua-emulators:v4
    container_name: kua-emulators
    restart: unless-stopped
    ports:
      - "4100:4000" # Emulator UI
      - "8282:8080" # Firestore
      - "9190:9099" # Authentication
      - "9292:9199" # Storage
      - "5100:5001" # Cloud Functions
    volumes:
      - emulator-data:/root/.cache/firebase/emulators
    environment:
      - FIRESTORE_EMULATOR_HOST=firestore:8080
      - FIREBASE_AUTH_EMULATOR_HOST=auth:9099
      - FIREBASE_STORAGE_EMULATOR_HOST=storage:9199
      - FUNCTIONS_EMULATOR_HOST=functions:5001
      - GCP_PROJECT=kua-dev
    networks:
      - kua-network

volumes:
  emulator-data:
    driver: local

networks:
  kua-network:
    driver: bridge
    name: kua-network-v2
